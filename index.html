<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GPS History Tool</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{
 margin:0;
 height:100%;
 font-family:Inter,Arial;
 background:#f3f5f9;
 overflow:hidden;
}

#app{
 display:flex;
 height:100%;
 width:100%;
}

#left{
 width:360px;
 min-width:320px;
 background:white;
 border-right:1px solid #ddd;
 padding:14px;
 box-sizing:border-box;
 overflow:auto;
}

#divider{
 width:6px;
 cursor:col-resize;
 background:#e5e7eb;
}

#divider:hover{
 background:#cbd5f5;
}

#map{
 flex:1;
}

textarea{
 width:100%;
 height:120px;
 margin-top:6px;
 font-family:monospace;
 border-radius:6px;
 border:1px solid #ccc;
 padding:6px;
}

button{
 margin-top:10px;
 padding:10px;
 width:100%;
 border:none;
 border-radius:8px;
 background:#2563eb;
 color:white;
 cursor:pointer;
 transition:.15s;
}

button:hover{
 transform:scale(1.03);
 background:#1d4ed8;
}

.card{
 border:1px solid #ddd;
 border-radius:10px;
 padding:10px;
 margin-top:10px;
}

h3{
 margin:6px 0;
 font-size:14px;
}

label{
 font-size:12px;
 display:block;
 margin-top:8px;
}

input[type="range"],input[type="color"]{
 width:100%;
}
</style>
</head>

<body>

<div id="app">

<div id="left">

<h3>Input Excel (lon lat)</h3>
<textarea id="input"></textarea>

<button onclick="process()">Proses Penomoran</button>

<h3>Output</h3>
<textarea id="output"></textarea>

<button onclick="plot()">Plot Trajectory</button>

<div class="card">

<label>Ketebalan Jalur: <span id="wval">4</span></label>
<input type="range" id="weight" min="1" max="60" value="4"
 oninput="wval.innerText=this.value;updateStyle()">

<label>Warna Jalur</label>
<input type="color" id="color" value="#ff0000" oninput="updateStyle()">

</div>

<div class="card">

<label>
<input type="checkbox" id="showPoints" checked onchange="updateStyle()"> Tampilkan Titik
</label>

<label>Ukuran Titik: <span id="pval">5</span></label>
<input type="range" id="pointSize" min="1" max="30" value="5"
 oninput="pval.innerText=this.value;updateStyle()">

<label>Warna Titik</label>
<input type="color" id="pointColor" value="#0000ff" oninput="updateStyle()">

</div>

<button onclick="clearAll()">Clear</button>

</div>

<div id="divider"></div>

<div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

var map=L.map('map').setView([-6.2,106.8],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let layer=L.layerGroup().addTo(map);

let poly=null;
let points=[];
let coords=[];

// ===== SPLITTER =====

const divider=document.getElementById("divider");
const left=document.getElementById("left");

let dragging=false;

divider.addEventListener("mousedown",()=>dragging=true);

window.addEventListener("mouseup",()=>dragging=false);

window.addEventListener("mousemove",e=>{
 if(!dragging) return;

 let w=e.clientX;
 if(w<320) w=320;

 left.style.width=w+"px";
 map.invalidateSize();
});

// =====================

function clean(t){
 return t.match(/[-\d.,]+/)[0].replace(',','.');
}

function process(){
 let lines=input.value.split('\n');
 let out=[];
 let c=1;

 lines.forEach(l=>{
  l=l.trim();
  if(!l)return;
  let p=l.split(/\s+/);
  if(p.length<2)return;

  let lon=clean(p[0]);
  let lat=clean(p[1]);

  out.push(c+"."+lat+","+lon);
  c++;
 });

 output.value=out.join("\n");
}

function plot(){
 layer.clearLayers();
 coords=[];
 points=[];
 poly=null;

 output.value.split('\n').forEach(l=>{
  l=l.replace(/^\d+\./,'');
  if(!l)return;
  let p=l.split(',');
  coords.push([parseFloat(p[0]),parseFloat(p[1])]);
 });

 if(coords.length<2)return;

 poly=L.polyline(coords).addTo(layer);

 coords.forEach(c=>{
  let m=L.circleMarker(c);
  points.push(m);
  m.addTo(layer);
 });

 L.marker(coords[0]).addTo(layer).bindPopup("START");
 L.marker(coords[coords.length-1]).addTo(layer).bindPopup("STOP");

 map.fitBounds(poly.getBounds());

 updateStyle();
}

function updateStyle(){
 if(!poly)return;

 poly.setStyle({
  color:color.value,
  weight:parseInt(weight.value)
 });

 let show=showPoints.checked;
 let size=parseInt(pointSize.value);
 let pc=pointColor.value;

 points.forEach(p=>{
  if(show){
   p.setStyle({
    radius:size,
    color:pc,
    fillColor:pc,
    fillOpacity:1
   });
   if(!map.hasLayer(p))p.addTo(layer);
  }else{
   layer.removeLayer(p);
  }
 });
}

function clearAll(){
 layer.clearLayers();
 input.value="";
 output.value="";
 poly=null;
 points=[];
 coords=[];
 map.setView([-6.2,106.8],13);
}

</script>

</body>
</html>
